# Microservice Pattern
- 본문 인용: 스프링 마이크로서비스 코딩 공작소(존 카넬 지음, 정성권님 옮김)

### 핵심 개발 패턴(core development patterns)

- 기본 서비스 설계
    - 서비스 세분성: 서비스가 담당해야 할 적정한 책임 수준은 얼마인가?
    - 통신 프로토콜: 클라이언트와 서비스가 데이터를 교환하는 방법
    - 인터페이스 설계: 서비스 엔드포인트를 클라이언트에 공개하는 방법
    - 구성 관리: 서비스가 애플리케이션별 구성을 관리해 코드와 구성이 독립적인 개체가 되는 방법
    - 이벤트 프로세싱: 이벤트를 사용해 서비스 간 상태 및 데이터 변경 사항을 통신하는 방법

### **라우팅 패턴(routing patterns)**

- 마이크로서비스를 사용하려는 클라이언트 애플리케이션 서비스의 위치를 발견하고 라우팅하는 방법을 다룬다.
- 서비스의 물리적 IP 주소를 추상화하고 서비스 호출에 대한 단일 진입점을 만들어야 모든 서비스 호출에 대한 일관된 보안과 콘텐츠 정책을 보장할 수 있다.

- "서비스에 대한 클라이언트의 요청을 특정 서비스 인스턴스에 어떻게 전달할 수 있을까?"
    - **서비스 디스커버리**(service discovery)
    "클라이언트 애플리케이션이 서비스 위치를 하드코딩하지 않고 찾을 수 있도록 마이크로서비스를 어떻게 탐색 가능하게 만들 수 있을까?"
    "오작동하는 마이크로서비스 인스턴스를 가용 서비스 인스턴스 풀에서 어떻게 제거해야 할까?"
        - 클라이언트에서 서비스의 물리적 위치를 추상화한다.
        - 확장하기 위해 새 마이크로서비스 인스턴스가 추가되고 비정상 서비스 인스턴스는 투명하게 서비스에서 제거된다.
    - **서비스 라우팅**(service routing)
    "보안 정책과 라우팅 규칙을 마이크로서비스 애플리케이션의 여러 서비스와 서비스 인스턴스에 차별 없이 적용하기 위해 모든 서비스에 대한 단일 진입점을 제공하는 방법은 무엇인가?"
    "팀의 각 개발자가 서비스에 라우팅을 제공하기 위한 솔루션을 자체적으로 마련할 필요가 없도록 하는 방법은 무엇인가?"
        - 마이크로서비스 클라이언트에 인가 및 인증, 콘텐츠 검사 등 정책 시행 지점으로 사용되고 연결되는 논리적 단일 URL을 제공한다.

### 클라이언트 회복성 패턴(client resiliency patterns)

마이크로서비스를 사용하면 오작동하는 서비스에서 서비스 호출자를 보호해야 하며, 서비스 하나가 느려지거나 다운되면 해당 서비스 이상의 중단이 발생할 수 있다는 것을 기억한다.

- 클라이언트 측 부하 분산(client-side load balancing)
"마이크로서비스의 여러 인스턴스에 대한 호출이 정상 인스턴스에 분산하도록 서비스 인스턴스의 위치를 캐싱하는 방법은 무엇인가?"
    - 서비스 클라이언트는 서비스 디스커버리에서 검색한 마이크로서비스 엔드포인트를 캐시하고 인스턴스 간 서비스의 호출 부하를 분산한다.

- 회로 차단기 패턴(circuit breakers pattern)
"클라이언트가 고장 나거나 성능 문제가 있는 서비스를 계속 호출하지 않게 하는 방법은 무엇인가?"
    - 서비스가 느리게 실행되면 서비스를 호출하는 클라이언트의 리소스가 소모되므로 비정상 마이크로서비스 호출이 빨리 실패하면 호출 클라이언트가 신속하게 응답하고 적절한 조치를 취할 수 있다.
    - 서비스 클라이언트가 실패한 서비스를 반복적으로 호출하지 않게 한다. 그 대신 클라이언트를 보호하기 위해 회로 차단기가 빨리 실패한다.

- 폴백 패턴(fallback pattern)
"서비스 호출이 실패할 때 호출한 마이크로서비스가 아닌 다른 대체수단을 사용해 서비스 클라이언트가 작업을 수행할 수 있게 하는 '플러그인' 메커니즘을 어떻게 제공할 것인가?"
"클라이언트가 실패할 때 데이터를 검색하거나 조치를 취할 수 있는 대체 경로가 있는가?"
- 벌크헤드 패턴(bulkhead pattern)
"마이크로서비스 애플리케이션은 작업을 수행하기 위해 여러 분산 자원을 사용한다."
"오작동하는 서비스 호출 하나가 나머지 애플리케이션에 부정적인 영향을 미치지 않도록 이러한 호출을 구분하는 방법은 무엇일까?"
"오작동하는 서비스 호출 하나가 나머지 애플리케이션에 부정적인 영향을 미치지 않도록 클라이언트에서 다른 서비스 호출을 어떻게 격리하는가?"

### 보안 패턴(security patterns)

- 인증(authentication)
"서비스를 호출하는 서비스 클라이언트가 자신이라는 것을 어떻게 알 수 있는가?"
- 인가(authorization)
"마이크로서비스를 호출하는 서비스 클라이언트가 수행하려는 작업을 수행할 자격이 있는지 어떻게 알 수 있는가?"
- 자격 증명 관리(credential management)와 전파(propagation)
"서비스 클라이언트가 한 트랜잭션과 관련된 여러 서비스 호출에서 자격 증명을 항상 제시하지 않아도 될 방법은 무엇인가?"
"OAuth와 JWT 같은 토큰 기반 보안 표준을 사용해 토큰(서비스 호출 간 전달해 사용자를 인증하고 인가할 수 있는 토큰)을 얻는 방법은 무엇인가?"

### 로깅 및 추적 패턴(logging and tracing patterns)

- 로그 상관관계(log correlation)
"단일 트랜잭션에 대해 여러 서비스 간 생성된 모든 로그를 함께 연결하는 방법은 무엇인가?" → 상관관계 ID를 구현하는 방법
상관관계 ID → 모든 서비스 호출 사이에 전달되는 고유 식별자 & 각 서비스에서 출력하는 로그 항목을 함께 묶는 데 사용된다.
- 로그 수집(log aggregation)
"서비스(개별 인스턴스)에서 생성된 모든 로그를 질의 가능한 단일 데이터베이스로 취합하는 방법은 무엇인가?"
"상관관계 ID로 수집된 로그 검색을 지원하는 방법은 무엇인가?"
- 마이크로서비스 추적(microservice tracing)
"트랜잭션과 연관된 모든 서비스에서 클라이언트 트랜잭션 흐름을 시각화하고 트랜잭션과 관련된 서비스의 성능 특성을 이해하는 방법은 무엇인가?"

### 빌드 및 배포 패턴(build and deployment patterns)

- 빌드 및 배포 파이프라인
"조직의 모든 환경에서 원클릭 빌드의 배포를 강조하는 반복 가능한 빌드 및 배포 프로세스를 어떻게 만드는가?"
- 코드형 인프라스트럭처(infrastructure as code)
"소스 제어를 사용해 실행하고 관리할 수 있는 코드로 서비스 프로비저닝을 처리하는 방법은 무엇인가?"
- 불변 서버(immutable servers)
"마이크로서비스 이미지를 생성하고 배포한 후 변경하지 못하게 하려면 어떻게 해야 하는가?"
- 피닉스 서버(phoenix servers)
"서버가 오래 실행될수록 구성 편차가 발생할 가능성도 높아지는데, 마이크로서비스를 실행하는 서버를 정기적으로 해체(종료)하고 불변 이미지를 재생성하려면 어떻게 해야 하는가?"
